<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEIM Framework | Quantifying the Architecture of Research Inequity</title>
    <meta name="description" content="HEIM Framework - Three-dimensional analysis of global health research equity across Discovery, Translation, and Knowledge dimensions">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%230f172a'/%3E%3Ctext x='16' y='24' font-family='Georgia,serif' font-size='24' font-weight='bold' fill='%23f59e0b' text-anchor='middle'%3EH%3C/text%3E%3C/svg%3E">

    <!-- Open Graph / Social Media -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://manuelcorpas.github.io/17-EHR/">
    <meta property="og:title" content="HEIM Framework | Three Dimensions of Compounding Neglect">
    <meta property="og:description" content="Interactive dashboard quantifying global health research inequity across 175 diseases, 70 biobanks, and 563,725 clinical trials. 538x research intensity disparity between diseases of comparable burden.">
    <meta property="og:image" content="https://manuelcorpas.github.io/17-EHR/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="HEIM Framework | Three Dimensions of Compounding Neglect">
    <meta name="twitter:description" content="Interactive dashboard quantifying global health research inequity across 175 diseases, 70 biobanks, and 563,725 clinical trials.">
    <meta name="twitter:image" content="https://manuelcorpas.github.io/17-EHR/og-image.png">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>

    <!-- Computation Engine (untouched) -->
    <script src="js/engine.js"></script>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- Mobile Progress Bar -->
    <div class="mobile-progress">
        <div class="mobile-progress-bar" id="progress-bar"></div>
    </div>

    <!-- Dot Navigation -->
    <nav class="dot-nav" id="dot-nav">
        <div class="dot-nav-item active" data-section="overview">
            <span class="dot-nav-label">Overview</span>
            <span class="dot-nav-dot"></span>
        </div>
        <div class="dot-nav-item" data-section="framework">
            <span class="dot-nav-label">Framework</span>
            <span class="dot-nav-dot"></span>
        </div>
        <div class="dot-nav-item" data-section="rankings">
            <span class="dot-nav-label">Rankings</span>
            <span class="dot-nav-dot"></span>
        </div>
        <div class="dot-nav-item" data-section="equity">
            <span class="dot-nav-label">Equity</span>
            <span class="dot-nav-dot"></span>
        </div>
        <div class="dot-nav-item" data-section="explorer">
            <span class="dot-nav-label">Explorer</span>
            <span class="dot-nav-dot"></span>
        </div>
        <div class="dot-nav-item" data-section="methods">
            <span class="dot-nav-label">Methods</span>
            <span class="dot-nav-dot"></span>
        </div>
    </nav>

    <!-- ============================================================
         SECTION 1: OVERVIEW (Hero)
         ============================================================ -->
    <section id="overview" class="scroll-section hero-section">
        <h1 class="hero-title">Three Dimensions of Compounding Neglect</h1>
        <p class="hero-subtitle">How Biobanks, Clinical Trials, and Scientific Literature Systematically Exclude the Global South</p>

        <div class="hero-stat">
            <div class="hero-stat-number" id="hero-top-score">538&times;</div>
            <div class="hero-stat-label">Research intensity disparity between diseases of comparable burden</div>
            <div class="hero-stat-detail" id="hero-stat-detail">Lymphatic filariasis: 89 trials for 1.3M DALYs vs Type 2 diabetes: 47,892 trials for 2.5M DALYs</div>
        </div>

        <p class="hero-authors">Corpas M, Freidin MB, Valdivia-Silva J, Baker S, Fatumo S, Guio H (2026)</p>

        <div class="scroll-indicator" onclick="document.getElementById('framework').scrollIntoView({behavior:'smooth'})">&#8595;</div>
    </section>

    <!-- ============================================================
         SECTION 2: FRAMEWORK
         ============================================================ -->
    <section id="framework" class="scroll-section">
        <div class="section-inner">
            <h2 class="section-heading">Three Dimensions of Research Inequity</h2>
            <p class="section-subheading">HEIM measures compound neglect across discovery, translation, and knowledge - revealing how disadvantage accumulates at every stage of the research pipeline.</p>

            <div class="framework-cards">
                <!-- Discovery -->
                <div class="framework-card framework-card--discovery">
                    <div class="framework-card-label">Discovery</div>
                    <div class="framework-card-stat" id="fw-discovery-stat">70 biobanks</div>
                    <div class="framework-card-desc"><span id="fw-discovery-gaps">22</span> critical gaps identified</div>
                    <div class="framework-mini-chart">
                        <div class="framework-mini-bar" id="fw-discovery-bar" style="width: 31%; background: var(--dim-discovery);">31% critical</div>
                    </div>
                </div>

                <!-- Translation -->
                <div class="framework-card framework-card--translation">
                    <div class="framework-card-label">Translation</div>
                    <div class="framework-card-stat" id="fw-translation-stat">563,725 trials</div>
                    <div class="framework-card-desc"><span id="fw-translation-gap">2.4</span>x intensity gap</div>
                    <div class="framework-mini-chart">
                        <div class="framework-mini-bar" id="fw-gs-bar" style="width: 20%; background: var(--dim-translation);">GS 20%</div>
                    </div>
                </div>

                <!-- Knowledge -->
                <div class="framework-card framework-card--knowledge">
                    <div class="framework-card-label">Knowledge</div>
                    <div class="framework-card-stat" id="fw-knowledge-stat">13.1M papers</div>
                    <div class="framework-card-desc">NTDs <span id="fw-knowledge-isolation">44</span>% more isolated</div>
                    <div class="framework-mini-chart">
                        <canvas id="chart-mini-isolation" height="32"></canvas>
                    </div>
                </div>
            </div>

            <div class="equity-figure" style="margin-top: 2rem;">
                <img src="figures/Fig_01_Framework_Schematic.png" alt="HEIM Framework - Three Dimensions of Research Inequity" loading="lazy">
                <p class="equity-figure-caption">Figure 1. The HEIM framework quantifies research inequity across three independent dimensions: Discovery (biobank gaps), Translation (clinical trial equity), and Knowledge (semantic isolation).</p>
            </div>

            <div class="formula-box" id="formula-display">
                <code>Unified = <span class="fw">0.501</span> &times; Discovery + <span class="fw">0.293</span> &times; Translation + <span class="fw">0.206</span> &times; Knowledge</code>
                <div style="margin-top: 0.5rem; font-size: 0.75rem; color: #94a3b8;">PCA-derived weights (PC1 explains 63.3% variance, n=86 diseases)</div>
            </div>
        </div>
    </section>

    <!-- ============================================================
         SECTION 3: DISEASE RANKINGS
         ============================================================ -->
    <section id="rankings" class="scroll-section">
        <div class="section-inner">
            <h2 class="section-heading">The Most Neglected Diseases</h2>
            <p class="section-subheading">Ranked by unified score combining biobank gaps, clinical trial equity, and semantic isolation.</p>

            <!-- Interactive chart: Top 20 diseases -->
            <div class="ranking-chart-container" style="height: 700px;">
                <canvas id="chart-unified-ranking"></canvas>
            </div>

            <div class="callout-box">
                <strong>All top-10 most neglected diseases are infectious conditions exclusively affecting the Global South</strong> - 9 of 10 are WHO-classified neglected tropical diseases, collectively affecting over 1.5 billion people.
            </div>

            <div class="stats-row">
                <div class="stats-row-item">
                    <div class="stats-row-value" id="rank-mean">19.3</div>
                    <div class="stats-row-label">Mean Score</div>
                </div>
                <div class="stats-row-item">
                    <div class="stats-row-value" id="rank-range">5.0 &ndash; 46.9</div>
                    <div class="stats-row-label">Score Range</div>
                </div>
                <div class="stats-row-item">
                    <div class="stats-row-value" id="rank-3d-count">86</div>
                    <div class="stats-row-label">3-Dimension Diseases</div>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================================
         SECTION 4: EQUITY GAP
         ============================================================ -->
    <section id="equity" class="scroll-section">
        <div class="section-inner">
            <h2 class="section-heading">The Geography of Neglect</h2>
            <p class="section-subheading">Research investment follows wealth, not disease burden.</p>

            <div class="equity-layout">
                <!-- Left: Intensity gap chart -->
                <div class="equity-chart-col">
                    <div class="chart-container" style="height: 500px;">
                        <canvas id="chart-intensity-gap"></canvas>
                    </div>
                </div>

                <!-- Right: Stat blocks -->
                <div class="equity-stats-col">
                    <div class="equity-stat-block">
                        <div class="equity-stat-value">57.78:1</div>
                        <div class="equity-stat-label">HIC vs LMIC publication ratio (biobanks)</div>
                    </div>
                    <div class="equity-stat-block">
                        <div class="equity-stat-value" id="eq-ct-ratio">2.5:1</div>
                        <div class="equity-stat-label">HIC vs LMIC trial site ratio</div>
                    </div>
                    <div class="equity-stat-block">
                        <div class="equity-stat-value" id="eq-cancer-pct">61.5%</div>
                        <div class="equity-stat-label">Clinical trials focused on cancer</div>
                    </div>
                </div>
            </div>

            <!-- Pipeline paradox callout -->
            <div class="pipeline-paradox">
                <h4>The Pipeline Paradox</h4>
                <p>Geographic concentration is <strong>better</strong> in clinical trials (2.5:1 vs 57.8:1 HIC:LMIC). But <strong>disease priorities are worse</strong>: lymphatic filariasis has 89 trials for 1.3M DALYs, while type 2 diabetes has 47,892 trials for 2.5M DALYs - a <strong>538-fold disparity</strong> for comparable disease burden.</p>
            </div>

            <!-- Interactive Charts -->
            <div class="chart-container" style="height: 450px; margin: 2rem 0;">
                <canvas id="chart-trial-sites"></canvas>
            </div>

            <div class="chart-container" style="height: 250px; margin: 2rem 0;">
                <canvas id="chart-regional-pubs"></canvas>
            </div>

            <div class="chart-container" style="height: 120px; margin: 2rem 0;">
                <canvas id="chart-ntd-isolation"></canvas>
            </div>
        </div>
    </section>

    <!-- ============================================================
         SECTION 5: INTERACTIVE EXPLORER
         ============================================================ -->
    <section id="explorer" class="scroll-section">
        <div class="section-inner">
            <h2 class="section-heading">Interactive Explorer</h2>
            <p class="section-subheading">Adjust weights, model scenarios, and explore the data.</p>

            <!-- 5a: Weight Adjustment + Live Rankings -->
            <div class="explorer-subsection">
                <h3 class="explorer-subtitle">Weight Adjustment</h3>
                <p class="explorer-desc">Modify the PCA-derived dimension weights and watch rankings update in real time.</p>

                <div class="weight-status-bar">
                    <span class="weight-status-text" id="weight-status">Using published PCA weights</span>
                    <button class="btn btn-secondary" onclick="resetAllWeights()">Reset to Defaults</button>
                </div>

                <div class="slider-group">
                    <div class="slider-row">
                        <label class="slider-label">
                            <span class="dim-dot dim-dot--discovery"></span> Discovery (Gap Score)
                        </label>
                        <input type="range" class="weight-slider" id="slider-w-discovery" min="0" max="100" value="50" step="1">
                        <span class="slider-value" id="val-w-discovery">0.501</span>
                    </div>
                    <div class="slider-row">
                        <label class="slider-label">
                            <span class="dim-dot dim-dot--translation"></span> Translation (Trial Equity)
                        </label>
                        <input type="range" class="weight-slider" id="slider-w-translation" min="0" max="100" value="29" step="1">
                        <span class="slider-value" id="val-w-translation">0.293</span>
                    </div>
                    <div class="slider-row">
                        <label class="slider-label">
                            <span class="dim-dot dim-dot--knowledge"></span> Knowledge (Semantic Isolation)
                        </label>
                        <input type="range" class="weight-slider" id="slider-w-knowledge" min="0" max="100" value="21" step="1">
                        <span class="slider-value" id="val-w-knowledge">0.206</span>
                    </div>
                    <div class="slider-sum">
                        Sum: <span id="weight-sum">1.000</span>
                    </div>
                </div>

                <div class="formula-box live-formula" id="formula-unified">
                    <code>Unified = <span class="fw">0.501</span> &times; D_norm + <span class="fw">0.293</span> &times; T_norm + <span class="fw">0.206</span> &times; K_norm</code>
                </div>

                <!-- Live Rankings Table -->
                <div class="table-container">
                    <table class="data-table" id="table-live-rankings">
                        <thead><tr></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="exportWeightedCSV()">Export CSV</button>
                    <button class="btn btn-secondary" onclick="exportPDFReport()">Export PDF</button>
                </div>
            </div>

            <!-- 5b: Scenario Builder -->
            <div class="explorer-subsection">
                <h3 class="explorer-subtitle">Scenario Builder</h3>
                <p class="explorer-desc">Model "what if" scenarios to see how research investment changes would shift disease rankings.</p>

                <div class="scenario-grid">
                    <div class="scenario-card" data-scenario="increaseNTD50" onclick="runScenario('increaseNTD50')">
                        <div class="scenario-icon">+50%</div>
                        <h4>Increase NTD Research</h4>
                        <p>50% more clinical trials for all 17 WHO NTDs</p>
                    </div>
                    <div class="scenario-card" data-scenario="equaliseHICLMIC" onclick="runScenario('equaliseHICLMIC')">
                        <div class="scenario-icon">=</div>
                        <h4>Equalise HIC/LMIC</h4>
                        <p>Double trial intensity for highly neglected diseases</p>
                    </div>
                    <div class="scenario-card" data-scenario="doubleInfectious" onclick="runScenario('doubleInfectious')">
                        <div class="scenario-icon">2x</div>
                        <h4>Double Infectious Research</h4>
                        <p>Double clinical trial intensity for infectious diseases</p>
                    </div>
                    <div class="scenario-card" data-scenario="reduceCancerBias" onclick="runScenario('reduceCancerBias')">
                        <div class="scenario-icon">&#8652;</div>
                        <h4>Reduce Cancer Bias</h4>
                        <p>Redistribute 30% of excess cancer trials to neglected diseases</p>
                    </div>
                </div>

                <!-- Scenario Results (hidden until a scenario is run) -->
                <div class="scenario-results" id="scenario-results">
                    <h4 style="margin-bottom: 0.5rem;">Results: <span id="scenario-name">--</span></h4>
                    <p style="font-size: 0.85rem; color: var(--nm-text-secondary); margin-bottom: 1rem;" id="scenario-desc">--</p>

                    <div class="scenario-comparison">
                        <div class="scenario-col">
                            <h4>Baseline Rankings</h4>
                            <div class="table-container">
                                <table class="data-table" id="table-scenario-before">
                                    <thead><tr><th>#</th><th>Disease</th><th>Score</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="scenario-col">
                            <h4>Most Affected Diseases</h4>
                            <div class="table-container">
                                <table class="data-table" id="table-scenario-after">
                                    <thead><tr><th>#</th><th>Disease</th><th>Score</th><th>&Delta;</th></tr></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="scenario-stats">
                        <div class="stat-box">
                            <div class="stat-box-value" id="scenario-rho">--</div>
                            <div class="stat-box-label">Spearman rho</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-value" id="scenario-moved">--</div>
                            <div class="stat-box-label">Rank changes</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-box-value" id="scenario-max-move">--</div>
                            <div class="stat-box-label">Largest shift</div>
                        </div>
                    </div>

                    <!-- Verification trace -->
                    <details class="scenario-verification" id="scenario-verification">
                        <summary class="verification-toggle">Verification trace</summary>
                        <div class="verification-body" id="verification-body">
                            <!-- Populated by JS -->
                        </div>
                    </details>
                </div>
            </div>

            <!-- 5d: Biobank Search/Compare -->
            <div class="explorer-subsection">
                <h3 class="explorer-subtitle">Biobank Comparison</h3>
                <p class="explorer-desc">Select 2-5 biobanks for side-by-side comparison. Grouped by WHO region.</p>

                <div class="biobank-search-container">
                    <input type="text" id="compare-biobank-search" class="search-input" placeholder="Filter biobanks...">
                </div>

                <div class="compare-checklist" id="compare-checklist">
                    <!-- Populated by JS -->
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="runBiobankComparison()">Compare Selected</button>
                    <button class="btn btn-secondary" onclick="clearBiobankSelection()">Clear</button>
                </div>

                <!-- Comparison Results (hidden until comparison is run) -->
                <div class="compare-results" id="compare-results">
                    <div class="compare-radar-container">
                        <canvas id="chart-compare-radar"></canvas>
                    </div>
                    <div class="table-container">
                        <table class="data-table" id="table-compare-biobanks">
                            <thead>
                                <tr id="compare-header-row">
                                    <th>Metric</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================================
         SECTION 6: METHODS & CITATION
         ============================================================ -->
    <section id="methods" class="scroll-section">
        <div class="section-inner">
            <h2 class="section-heading">Methods &amp; Citation</h2>
            <p class="section-subheading">Data sources, statistical validation, and how to cite this work.</p>

            <details>
                <summary>Data Sources</summary>
                <div class="details-content">
                    <p><strong>Biobanks (Discovery):</strong> Publication data from PubMed for 70 biobanks in the International HundredK+ Cohorts Consortium (IHCC). Disease coverage mapped to GBD 2021 taxonomy.</p>
                    <p><strong>Clinical Trials (Translation):</strong> 563,725 studies from ClinicalTrials.gov via the AACT database (2000-2025). 2,189,930 disease-trial mappings across 770,178 trial sites in 194 countries.</p>
                    <p><strong>PubMed Semantic (Knowledge):</strong> 13.1M papers with PubMedBERT embeddings (768-dimensional). 176 diseases analysed for semantic isolation, knowledge transfer potential, and research clustering.</p>
                    <p><strong>Disease Burden:</strong> Global Burden of Disease Study 2021 (IHME). 175 disease categories mapped to GBD Level 3 causes. 29 Global South Priority diseases identified.</p>
                </div>
            </details>

            <details>
                <summary>Key Metrics</summary>
                <div class="details-content">
                    <p><strong>Unified Score</strong> = w_D &times; Discovery_norm + w_T &times; Translation_norm + w_K &times; Knowledge_norm (PCA-derived weights: 0.501, 0.293, 0.206). Higher = more neglected.</p>
                    <p><strong>Gap Score (Discovery)</strong>: Three-tier scoring: zero publications (95), category thresholds (infectious/neglected), burden-normalised intensity deciles. Global South penalty (+10 if &lt;50 pubs).</p>
                    <p><strong>Research Intensity</strong> = Trials per Million DALYs. Measures research attention relative to disease burden.</p>
                    <p><strong>Semantic Isolation Index (SII)</strong>: Mean cosine distance from the global centroid of all biomedical knowledge. Higher = more isolated.</p>
                    <p><strong>Knowledge Transfer Potential (KTP)</strong>: Maximum similarity to any other disease. Lower = less benefit from related fields.</p>
                    <p><strong>Equity Alignment Score (EAS)</strong>: Per-biobank metric. EAS = 100 - (w_gap &times; GapSeverity + w_burden &times; BurdenMiss + w_capacity &times; CapacityPenalty).</p>
                </div>
            </details>

            <details>
                <summary>Statistical Validation</summary>
                <div class="details-content">
                    <p><strong>NTD Semantic Isolation:</strong> 17 WHO NTDs show 44% higher isolation than other diseases (mean SII 0.00211 vs 0.00146, P&nbsp;&lt;&nbsp;0.0001, Cohen's d&nbsp;=&nbsp;1.80).</p>
                    <p><strong>Dimension Orthogonality:</strong> r=0.07 between dimensions confirms they measure independent aspects of neglect.</p>
                    <p><strong>Ranking Robustness:</strong> 200 Dirichlet-distributed weight perturbations show mean Spearman rho &gt;0.95, confirming rankings are stable under weight variation.</p>
                    <p><strong>PCA Justification:</strong> PC1 explains 63.3% of variance across 86 diseases with complete data. PC1+PC2 explain 86.9%.</p>
                </div>
            </details>

            <details>
                <summary>Limitations</summary>
                <div class="details-content">
                    <ul>
                        <li><strong>ClinicalTrials.gov:</strong> US/Western registration bias; many non-US trials unregistered.</li>
                        <li><strong>PubMed:</strong> English-language bias; some diseases have incomplete MeSH coverage (lung cancer, Alzheimer's).</li>
                        <li><strong>Biobank coverage:</strong> 70 IHCC biobanks may not represent all global biobank activity.</li>
                        <li><strong>Temporal scope:</strong> Embeddings trained on 2000-2025 literature.</li>
                        <li><strong>Causal claims:</strong> Framework measures association not causation between dimensions.</li>
                    </ul>
                </div>
            </details>

            <div class="citation-box" id="citation-text">
                <button class="citation-copy-btn" onclick="copyCitation()">Copy</button>
                <p><strong>Corpas M, Freidin MB, Valdivia-Silva J, Baker S, Fatumo S, Guio H.</strong> (2026). Three Dimensions of Compounding Neglect: How Biobanks, Clinical Trials, and Scientific Literature Systematically Exclude the Global South. <em>In preparation</em>.</p>
            </div>

            <div class="methods-links">
                <a href="https://github.com/manuelcorpas/17-EHR" target="_blank" class="methods-link">GitHub Repository</a>
                <a href="mailto:m.corpas@westminster.ac.uk" class="methods-link">Contact: m.corpas@westminster.ac.uk</a>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="site-footer">
        <p class="site-footer-line"><strong>HEIM Framework v3.0</strong></p>
        <p class="site-footer-line">Data: GBD 2021, ClinicalTrials.gov, PubMed, PubMedBERT | <a href="https://github.com/manuelcorpas/17-EHR" target="_blank">GitHub</a></p>
        <p class="site-footer-line">Corpas, Freidin, Valdivia-Silva, Baker, Fatumo &amp; Guio (2026) - Three Dimensions of Compounding Neglect</p>
    </footer>

    <!-- Scripts -->
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>

</body>
</html>
