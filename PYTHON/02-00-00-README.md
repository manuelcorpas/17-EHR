# BHEM Pipeline Scripts

**Biobank Health Equity Monitor** - A step-by-step pipeline for analyzing global biobank research and deploying an interactive dashboard to GitHub Pages.

## Overview

This pipeline:
1. Fetches publications from PubMed for 50+ global biobanks
2. Maps publications to 25 priority diseases using MeSH terms
3. Computes research gap scores and equity metrics
4. Generates JSON data files for the web dashboard
5. Builds a static HTML/CSS/JS site for GitHub Pages

## Requirements

```bash
pip install biopython pandas numpy
```

## Pipeline Steps

Run these scripts **in order** from the repository root directory:

### Step 1: Fetch PubMed Data
```bash
python PYTHON/02-00-bhem-fetch-pubmed.py
```
- **Time:** 1-2 hours (fetches from PubMed API)
- **Output:** `DATA/bhem_publications.csv`
- Retrieves all publications mentioning 50+ biobanks
- Progress saved after each biobank (resumable)

### Step 2: Map to Diseases
```bash
python PYTHON/02-01-bhem-map-diseases.py
```
- **Time:** ~1 minute
- **Input:** `DATA/bhem_publications.csv`
- **Output:** `DATA/bhem_publications_mapped.csv`, `DATA/disease_registry.json`
- Maps publications to 25 priority diseases via MeSH terms

### Step 3: Compute Metrics
```bash
python PYTHON/02-02-bhem-compute-metrics.py
```
- **Time:** ~30 seconds
- **Input:** `DATA/bhem_publications_mapped.csv`
- **Output:** `DATA/bhem_metrics.json`, `DATA/bhem_biobank_metrics.csv`, `DATA/bhem_disease_metrics.csv`
- Computes:
  - Burden scores (DALYs + deaths + prevalence)
  - Gap scores (0-100, higher = larger research gap)
  - Research Opportunity Scores (ROS)
  - Equity metrics

### Step 4: Generate JSON
```bash
python PYTHON/02-03-bhem-generate-json.py
```
- **Time:** ~10 seconds
- **Input:** `DATA/bhem_metrics.json`, `DATA/bhem_publications_mapped.csv`
- **Output:** `docs/data/*.json`
- Creates optimized JSON files for the dashboard

### Step 5: Build Site
```bash
python PYTHON/02-04-bhem-build-site.py
```
- **Time:** Instant
- **Output:** `docs/index.html`, `docs/css/`, `docs/js/`
- Generates the complete static website

## Deploy to GitHub Pages

After running all scripts:

1. **Commit and push:**
   ```bash
   git add .
   git commit -m "Update BHEM dashboard"
   git push
   ```

2. **Enable GitHub Pages:**
   - Go to repository Settings â†’ Pages
   - Source: "Deploy from a branch"
   - Branch: `main`, Folder: `/docs`
   - Save

3. **Access your dashboard:**
   - URL: `https://[username].github.io/[repo]/`

## Biobanks Tracked (50+)

| Tier | Biobanks |
|------|----------|
| **Tier 1** | UK Biobank, Million Veteran Program, FinnGen, All of Us, Estonian Biobank |
| **Tier 2** | BioBank Japan, China Kadoorie, HUNT, deCODE, Kaiser Permanente, BioVU, Geisinger, Michigan Genomics |
| **Tier 3** | CONSTANCES, NAKO, LifeLines, Generation Scotland, Danish National, Swedish Twin |
| **Tier 4** | Taiwan Biobank, Korean Biobank, Singapore PRECISE |
| **Tier 5** | Qatar Biobank, Saudi Human Genome |
| **Tier 6** | H3Africa, Uganda Genome, AWI-Gen (ðŸŒ Africa) |
| **Tier 7** | Peruvian Genome, Mexico City Prospective, EPIGEN-Brazil (ðŸŒ Latin America) |
| **Tier 8** | eMERGE Network, TOPMed, GBMI |

## Diseases Tracked (25)

| Category | Diseases |
|----------|----------|
| **Cardiovascular** | Ischemic heart disease, Stroke |
| **Respiratory** | COPD, Asthma |
| **Metabolic** | Type 2 Diabetes |
| **Infectious** | Malaria ðŸŒ, Tuberculosis ðŸŒ, HIV/AIDS ðŸŒ, Diarrheal diseases ðŸŒ |
| **Neglected** | Neglected Tropical Diseases ðŸŒ |
| **Neurological** | Alzheimer's, Epilepsy, Parkinson's |
| **Mental Health** | Depression, Anxiety, Bipolar, Schizophrenia |
| **Cancer** | Lung cancer, Breast cancer |
| **Other NCDs** | Chronic kidney disease, Cirrhosis |
| **Musculoskeletal** | Low back pain |
| **Injuries** | Road traffic injuries ðŸŒ |
| **Maternal** | Neonatal disorders ðŸŒ, Preterm birth ðŸŒ |

ðŸŒ = Global South Priority

## Metrics Explained

### Gap Score (0-100)
Higher = larger gap between disease burden and research attention
- **Critical (>70):** Severely under-researched
- **High (50-70):** Significantly under-researched
- **Moderate (30-50):** Partially addressed
- **Low (<30):** Well-researched

### Research Opportunity Score (ROS)
Sum of burden scores for diseases with â‰¤2 publications from a biobank.
Higher ROS = more untapped potential for equity-aligned research.

### Equity Ratio
Research intensity in high-income countries vs Global South.
Ratio > 1 indicates HIC-focused research disparity.

## File Structure

```
repository/
â”œâ”€â”€ PYTHON/
â”‚   â”œâ”€â”€ 02-00-bhem-fetch-pubmed.py
â”‚   â”œâ”€â”€ 02-01-bhem-map-diseases.py
â”‚   â”œâ”€â”€ 02-02-bhem-compute-metrics.py
â”‚   â”œâ”€â”€ 02-03-bhem-generate-json.py
â”‚   â””â”€â”€ 02-04-bhem-build-site.py
â”œâ”€â”€ DATA/
â”‚   â”œâ”€â”€ bhem_publications.csv
â”‚   â”œâ”€â”€ bhem_publications_mapped.csv
â”‚   â”œâ”€â”€ bhem_metrics.json
â”‚   â”œâ”€â”€ bhem_biobank_metrics.csv
â”‚   â”œâ”€â”€ bhem_disease_metrics.csv
â”‚   â””â”€â”€ disease_registry.json
â””â”€â”€ docs/
    â”œâ”€â”€ index.html
    â”œâ”€â”€ .nojekyll
    â”œâ”€â”€ css/
    â”‚   â””â”€â”€ style.css
    â”œâ”€â”€ js/
    â”‚   â”œâ”€â”€ app.js
    â”‚   â””â”€â”€ charts.js
    â””â”€â”€ data/
        â”œâ”€â”€ summary.json
        â”œâ”€â”€ biobanks.json
        â”œâ”€â”€ diseases.json
        â”œâ”€â”€ matrix.json
        â””â”€â”€ trends.json
```

## Updating the Dashboard

To refresh the data:

```bash
# Re-run the full pipeline
python PYTHON/02-00-bhem-fetch-pubmed.py
python PYTHON/02-01-bhem-map-diseases.py
python PYTHON/02-02-bhem-compute-metrics.py
python PYTHON/02-03-bhem-generate-json.py
python PYTHON/02-04-bhem-build-site.py

# Commit and push
git add .
git commit -m "Update BHEM data $(date +%Y-%m-%d)"
git push
```

## Citation

If you use BHEM in your research, please cite:

> Corpas M, et al. (2025). EHR-Linked Biobank Expansion Reveals Global Health Inequities. 
> Annual Review of Biomedical Data Science.

## License

MIT License
